<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Style - ì»¤ë®¤ë‹ˆí‹°</title>
    <style>
        :root {
            --primary-color: #333;
            --accent-color: #5d5fef;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --gray-text: #888;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .wrapper {
            max-width: 1600px; margin: 0 auto; display: grid;
            grid-template-columns: 180px 1fr 180px; gap: 20px; padding: 20px; align-items: start;
        }

        header {
            background: var(--card-bg); border-bottom: 1px solid #ddd;
            position: sticky; top: 0; z-index: 100; height: 60px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .nav-inner { width: 100%; max-width: 1200px; display: flex; justify-content: space-between; padding: 0 20px; align-items: center; }
        .logo { font-size: 24px; font-weight: 800; font-style: italic; color: var(--accent-color); cursor: pointer; }
        
        .login-btn {
            background-color: var(--accent-color); color: white; padding: 8px 16px;
            border-radius: 20px; font-size: 13px; font-weight: bold; border: none; cursor: pointer;
        }
        .user-info { font-size: 14px; font-weight: 600; color: #333; display: flex; align-items: center; gap: 10px; }
        .logout-link { color: #888; font-size: 12px; cursor: pointer; text-decoration: underline; }

        .ad-banner {
            height: 600px; background: #e9ecef; color: #adb5bd;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; position: sticky; top: 80px; border-radius: 8px;
        }
        .ad-banner::after { content: "AD"; }

        .main-content { display: flex; flex-direction: column; gap: 25px; min-width: 0; }

        .photo-banner { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .photo-card {
            background: white; border-radius: 12px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s;
        }
        .photo-card:hover { transform: translateY(-3px); }
        .photo-img { width: 100%; height: 120px; background: #ddd; object-fit: cover; }
        .photo-info { padding: 10px; font-size: 14px; font-weight: 600; text-align: center; }

        .trend-section, .board-container {
            background: white; padding: 20px; border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .section-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .hot-badge { background: #ff4d4f; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; }

        .write-toggle-btn {
            width: 32px; height: 32px; border-radius: 50%;
            background-color: var(--bg-color); color: var(--primary-color);
            border: none; font-size: 20px; display: flex;
            align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .write-toggle-btn:hover { background-color: var(--accent-color); color: white; }

        /* --- ê¸€ì“°ê¸° í¼ ìˆ˜ì • (ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨) --- */
        .mini-write-form {
            background: #f8f9fa; padding: 15px; border-radius: 8px;
            margin-bottom: 20px; display: none; gap: 10px; flex-direction: column;
            border: 1px solid #eee; animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .form-row { display: flex; gap: 10px; align-items: center;}
        .mini-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .mini-textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical; font-family: inherit; }
        .mini-btn { background: var(--accent-color); color: white; border: none; padding: 0 20px; height: 40px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .mini-btn:hover { background: #4c4edb; }
        
        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ ë²„íŠ¼ ë° ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .file-input-label {
            display: flex; align-items: center; justify-content: center;
            width: 40px; height: 40px; background: #e9ecef; color: #555;
            border-radius: 4px; cursor: pointer; font-size: 20px;
        }
        .file-input-label:hover { background: #dde2e6; }
        .image-preview-box {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            position: relative; width: fit-content; margin-bottom: 10px;
            border: 1px solid #ddd; border-radius: 8px; overflow: hidden;
        }
        .preview-img { max-height: 150px; display: block; }
        .preview-close-btn {
            position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.5);
            color: white; border: none; border-radius: 50%; width: 24px; height: 24px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        /* --- ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ìˆ˜ì • --- */
        .post-list li { padding: 12px 0; border-bottom: 1px solid #f1f1f1; display: flex; justify-content: space-between; align-items: center; }
        /* ì¸ë„¤ì¼ê³¼ í…ìŠ¤íŠ¸ë¥¼ ê°ì‹¸ëŠ” ë˜í¼ */
        .post-item-inner { display: flex; align-items: center; gap: 15px; flex: 1; cursor: pointer; overflow: hidden; }
        .post-thumbnail { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; flex-shrink: 0; border: 1px solid #eee; }
        .post-info-wrapper { display: flex; flex-direction: column; gap: 4px; flex: 1; min-width: 0; }
        .post-title { font-size: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .post-title:hover { text-decoration: underline; }
        .post-meta { font-size: 12px; color: #888; display: flex; gap: 10px; }
        .del-btn { color: #ccc; cursor: pointer; border: none; background: none; font-size: 18px; margin-left: 10px;}
        .del-btn:hover { color: red; }

        .detail-view { display: none; flex-direction: column; gap: 20px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .detail-header { border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .back-btn { background: none; border: 1px solid #ddd; padding: 5px 12px; border-radius: 4px; cursor: pointer; margin-bottom: 15px; display: inline-block;}
        .back-btn:hover { background: #f1f1f1; }
        
        .detail-title-text { font-size: 24px; font-weight: 800; margin-bottom: 10px; }
        .detail-meta-info { font-size: 13px; color: #888; display: flex; gap: 15px; }
        /* ìƒì„¸í˜ì´ì§€ ë³¸ë¬¸ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .detail-main-image { width: 100%; max-height: 500px; object-fit: contain; border-radius: 12px; margin-bottom: 20px; background: #f8f9fa; }
        .detail-body { background: white; padding: 30px; border-radius: 12px; min-height: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); font-size: 16px; line-height: 1.6; white-space: pre-wrap; }

        .comment-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .comment-header { font-weight: 700; margin-bottom: 15px; border-bottom: 2px solid #f1f1f1; padding-bottom: 10px; }
        .comment-list { list-style: none; margin-bottom: 20px; }
        .comment-item { padding: 12px 0; border-bottom: 1px solid #f8f8f8; }
        .comment-meta { font-size: 12px; color: #888; margin-bottom: 4px; display: flex; justify-content: space-between;}
        .comment-author { font-weight: bold; color: #333; margin-right: 8px; }
        .comment-input-box { display: flex; gap: 10px; }
        .comment-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .comment-btn { background: #333; color: white; border: none; padding: 0 20px; border-radius: 4px; font-weight: bold; cursor: pointer; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            display: none; justify-content: center; align-items: center;
        }
        .auth-box {
            background: white; padding: 30px; border-radius: 12px; width: 350px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); position: relative;
        }
        .auth-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; text-align: center; }
        .auth-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .auth-btn { width: 100%; padding: 12px; background: var(--accent-color); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .auth-switch { text-align: center; margin-top: 15px; font-size: 13px; color: #666; }
        .switch-link { color: var(--accent-color); cursor: pointer; font-weight: bold; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #999; }

        @media (max-width: 1024px) {
            .wrapper { grid-template-columns: 1fr; }
            .ad-banner { display: none; }
            .photo-banner { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <header>
        <div class="nav-inner">
            <div class="logo" onclick="goBack()">Style</div>
            <nav class="nav-menu">
                <div id="auth-section">
                    <button class="login-btn" onclick="openModal()">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</button>
                </div>
            </nav>
        </div>
    </header>

    <div class="wrapper">
        <aside class="ad-banner" style="background:#e3f2fd; color:#2196f3;"></aside>

        <div style="min-width: 0; width: 100%;">
            <main id="main-view" class="main-content">
                <div class="photo-banner">
                    <div class="photo-card"><img src="https://via.placeholder.com/300x150/5d5fef/ffffff?text=OOTD" class="photo-img"><div class="photo-info">ë°ì¼ë¦¬ ë£©</div></div>
                    <div class="photo-card"><img src="https://via.placeholder.com/300x150/ff7675/ffffff?text=HOT" class="photo-img"><div class="photo-info">ì¸ê¸° ì•„ì´í…œ</div></div>
                    <div class="photo-card"><img src="https://via.placeholder.com/300x150/74b9ff/ffffff?text=Shoes" class="photo-img"><div class="photo-info">ì‹ ë°œ ì¶”ì²œ</div></div>
                    <div class="photo-card"><img src="https://via.placeholder.com/300x150/fdcb6e/ffffff?text=Review" class="photo-img"><div class="photo-info">ë‚´ëˆë‚´ì‚° ë¦¬ë·°</div></div>
                </div>

                <div class="trend-section">
                    <div class="section-header"><div class="section-title">ğŸ”¥ ì‹¤ì‹œê°„ íŠ¸ë Œë“œ</div></div>
                    <ul id="trend-list" class="post-list"></ul>
                </div>

                <div class="board-container">
                    <div class="section-header">
                        <div class="section-title">ğŸ’¬ ììœ  ê²Œì‹œíŒ</div>
                        <button class="write-toggle-btn" onclick="toggleForm('free')">+</button>
                    </div>
                    <div id="free-form-box" class="mini-write-form">
                        <div class="form-row">
                            <input type="text" id="free-title" class="mini-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <label for="free-file-input" class="file-input-label">ğŸ“·</label>
                            <input type="file" id="free-file-input" accept="image/*" style="display:none;" onchange="handleImageSelect(event, 'free')">
                            <button class="mini-btn" onclick="addPost('free')">ë“±ë¡</button>
                        </div>
                        <div id="free-preview-box" class="image-preview-box">
                            <img id="free-image-preview" class="preview-img" src="">
                            <button class="preview-close-btn" onclick="clearPreview('free')">&times;</button>
                        </div>
                        <textarea id="free-content" class="mini-textarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <ul id="free-list" class="post-list"></ul>
                </div>

                <div class="board-container">
                    <div class="section-header">
                        <div class="section-title">ğŸ‘• íŒ¨ì…˜ ê²Œì‹œíŒ</div>
                        <button class="write-toggle-btn" onclick="toggleForm('fashion')">+</button>
                    </div>
                    <div id="fashion-form-box" class="mini-write-form">
                        <div class="form-row">
                            <input type="text" id="fashion-title" class="mini-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <label for="fashion-file-input" class="file-input-label">ğŸ“·</label>
                            <input type="file" id="fashion-file-input" accept="image/*" style="display:none;" onchange="handleImageSelect(event, 'fashion')">
                            <button class="mini-btn" onclick="addPost('fashion')">ë“±ë¡</button>
                        </div>
                        <div id="fashion-preview-box" class="image-preview-box">
                            <img id="fashion-image-preview" class="preview-img" src="">
                            <button class="preview-close-btn" onclick="clearPreview('fashion')">&times;</button>
                        </div>
                        <textarea id="fashion-content" class="mini-textarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <ul id="fashion-list" class="post-list"></ul>
                </div>
            </main>

            <main id="detail-view" class="detail-view">
                <div>
                    <button class="back-btn" onclick="goBack()">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                    <div class="detail-header">
                        <h1 id="view-title" class="detail-title-text">ê¸€ ì œëª©</h1>
                        <div class="detail-meta-info">
                            <span id="view-author">ì‘ì„±ì</span>
                            <span id="view-date">ë‚ ì§œ</span>
                            <span id="view-views">ì¡°íšŒìˆ˜</span>
                        </div>
                    </div>
                </div>

                <img id="view-main-image" class="detail-main-image" style="display:none;">

                <div id="view-content" class="detail-body">ë‚´ìš©</div>

                <div class="comment-section">
                    <div class="comment-header">ëŒ“ê¸€ <span id="comment-count">0</span></div>
                    <ul id="comment-list" class="comment-list"></ul>
                    <div class="comment-input-box">
                        <input type="text" id="comment-input" class="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš” (ë¡œê·¸ì¸ í•„ìš”)">
                        <button class="comment-btn" onclick="addComment()">ë“±ë¡</button>
                    </div>
                </div>
            </main>
        </div>
        <aside class="ad-banner" style="background:#fff3e0; color:#ff9800;"></aside>
    </div>

    <div id="login-modal" class="modal-overlay">
        <div class="auth-box">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="login-form">
                <div class="auth-title">ë¡œê·¸ì¸</div>
                <input type="text" id="login-id" class="auth-input" placeholder="ì•„ì´ë””">
                <input type="password" id="login-pw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
                <button class="auth-btn" onclick="login()">ë¡œê·¸ì¸ í•˜ê¸°</button>
                <div class="auth-switch">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <span class="switch-link" onclick="switchAuthMode('signup')">íšŒì›ê°€ì…</span></div>
            </div>
            <div id="signup-form" style="display:none;">
                <div class="auth-title">íšŒì›ê°€ì…</div>
                <input type="text" id="reg-id" class="auth-input" placeholder="ì•„ì´ë””">
                <input type="password" id="reg-pw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
                <input type="text" id="reg-nick" class="auth-input" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„">
                <button class="auth-btn" onclick="signup()">ê°€ì… í•˜ê¸°</button>
                <div class="auth-switch">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <span class="switch-link" onclick="switchAuthMode('login')">ë¡œê·¸ì¸</span></div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentPostId = null;
        // ê¸€ ì‘ì„± ì¤‘ ì„ì‹œë¡œ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë‹´ì„ ë³€ìˆ˜
        let tempImageData = { free: null, fashion: null };

        document.addEventListener('DOMContentLoaded', () => {
            try {
                checkLoginStatus();
                window.onpopstate = function(event) {
                    if (event.state && event.state.page === 'detail') {
                        renderDetailView(event.state.id);
                    } else {
                        renderMainView();
                    }
                };
                renderAll(); 
            } catch (e) { console.error("ì´ˆê¸°í™” ì˜¤ë¥˜:", e); }
        });

        // --- ì´ë¯¸ì§€ ì²˜ë¦¬ ê´€ë ¨ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€ë¨) ---
        
        // 1. íŒŒì¼ ì„ íƒ ì‹œ ì‹¤í–‰ (ì´ë¯¸ì§€ë¥¼ Base64 ë¬¸ìì—´ë¡œ ë³€í™˜)
        function handleImageSelect(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            // ìš©ëŸ‰ ì²´í¬ (ì˜ˆ: 2MB ì œí•œ) - ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í•œê³„ ë•Œë¬¸
            if (file.size > 2 * 1024 * 1024) {
                alert('ì´ë¯¸ì§€ ìš©ëŸ‰ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. (2MB ì´í•˜ë§Œ ê°€ëŠ¥)');
                event.target.value = ''; // ì„ íƒ ì´ˆê¸°í™”
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64String = e.target.result;
                tempImageData[type] = base64String; // ì„ì‹œ ì €ì¥

                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                document.getElementById(type + '-image-preview').src = base64String;
                document.getElementById(type + '-preview-box').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // 2. ë¯¸ë¦¬ë³´ê¸° ì·¨ì†Œ (X ë²„íŠ¼)
        function clearPreview(type) {
            tempImageData[type] = null;
            document.getElementById(type + '-file-input').value = '';
            document.getElementById(type + '-image-preview').src = '';
            document.getElementById(type + '-preview-box').style.display = 'none';
        }


        // --- í™”ë©´ ì „í™˜ ë° íˆìŠ¤í† ë¦¬ ê´€ë¦¬ ---

        function goDetail(id) {
            history.pushState({ page: 'detail', id: id }, '', ''); 
            renderDetailView(id);
        }

        function goBack() { history.back(); }

        // --- ë·° ë Œë”ë§ í•¨ìˆ˜ë“¤ ---

        function renderDetailView(id) {
            currentPostId = id;
            let posts = JSON.parse(localStorage.getItem('stylePosts')) || [];
            let post = posts.find(p => p.id === id);
            
            if(post) {
                document.getElementById('view-title').innerText = post.title;
                document.getElementById('view-author').innerText = "ğŸ‘¤ " + post.nickname;
                document.getElementById('view-date').innerText = "ğŸ•’ " + post.date;
                document.getElementById('view-views').innerText = "ğŸ‘ï¸ " + (post.views || 0);
                document.getElementById('view-content').innerText = post.content;

                // ì´ë¯¸ì§€ ì²˜ë¦¬ (ìƒˆë¡œ ì¶”ê°€ë¨)
                const mainImage = document.getElementById('view-main-image');
                if (post.image) {
                    mainImage.src = post.image;
                    mainImage.style.display = 'block';
                } else {
                    mainImage.src = '';
                    mainImage.style.display = 'none';
                }

                renderComments(post);

                document.getElementById('main-view').style.display = 'none';
                document.getElementById('detail-view').style.display = 'flex';
                window.scrollTo(0, 0);
            }
        }

        function renderMainView() {
            currentPostId = null;
            document.getElementById('detail-view').style.display = 'none';
            document.getElementById('main-view').style.display = 'flex';
            renderAll(); 
        }

        // --- ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ---

        function renderComments(post) {
            const list = document.getElementById('comment-list');
            const count = document.getElementById('comment-count');
            const comments = post.comments || [];

            count.innerText = comments.length;
            list.innerHTML = '';

            comments.forEach((comment, index) => {
                list.innerHTML += `
                    <li class="comment-item">
                        <div class="comment-meta">
                            <span class="comment-author">${comment.nickname}</span>
                            <span>${comment.date}</span>
                        </div>
                        <div>${comment.content}</div>
                        ${(currentUser && currentUser.id === comment.authorId) ? 
                            `<button onclick="deleteComment(${index})" style="color:red; border:none; background:none; font-size:11px; cursor:pointer; margin-top:5px;">ì‚­ì œ</button>` 
                            : ''}
                    </li>
                `;
            });
        }

        function addComment() {
            if (!currentUser) { alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); openModal(); return; }
            if (!currentPostId) return;
            const input = document.getElementById('comment-input');
            const content = input.value.trim();
            if (!content) { alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            let posts = JSON.parse(localStorage.getItem('stylePosts')) || [];
            let postIndex = posts.findIndex(p => p.id === currentPostId);

            if (postIndex !== -1) {
                const now = new Date();
                const timeString = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
                if (!posts[postIndex].comments) posts[postIndex].comments = [];
                posts[postIndex].comments.push({
                    authorId: currentUser.id, nickname: currentUser.nickname, content: content, date: timeString
                });
                localStorage.setItem('stylePosts', JSON.stringify(posts));
                input.value = '';
                renderComments(posts[postIndex]);
            }
        }

        function deleteComment(idx) {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            let posts = JSON.parse(localStorage.getItem('stylePosts')) || [];
            let postIndex = posts.findIndex(p => p.id === currentPostId);
            if (postIndex !== -1) {
                posts[postIndex].comments.splice(idx, 1);
                localStorage.setItem('stylePosts', JSON.stringify(posts));
                renderComments(posts[postIndex]);
            }
        }

        function checkLoginStatus() {
            try {
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) { currentUser = JSON.parse(storedUser); updateAuthUI(); }
            } catch (e) { localStorage.removeItem('currentUser'); }
        }

        function updateAuthUI() {
            const authSection = document.getElementById('auth-section');
            if (currentUser) {
                authSection.innerHTML = `<div class="user-info"><span>ğŸ‘‹ ${currentUser.nickname}ë‹˜</span><span class="logout-link" onclick="logout()">(ë¡œê·¸ì•„ì›ƒ)</span></div>`;
            } else {
                authSection.innerHTML = `<button class="login-btn" onclick="openModal()">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</button>`;
            }
        }

        function signup() {
            const id = document.getElementById('reg-id').value;
            const pw = document.getElementById('reg-pw').value;
            const nick = document.getElementById('reg-nick').value;
            if (!id || !pw || !nick) { alert('ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
            let users = JSON.parse(localStorage.getItem('styleUsers')) || [];
            if (users.find(u => u.id === id)) { alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.'); return; }
            users.push({ id, pw, nickname: nick });
            localStorage.setItem('styleUsers', JSON.stringify(users));
            alert('ê°€ì… ì„±ê³µ!'); switchAuthMode('login');
        }

        function login() {
            const id = document.getElementById('login-id').value;
            const pw = document.getElementById('login-pw').value;
            let users = JSON.parse(localStorage.getItem('styleUsers')) || [];
            const user = users.find(u => u.id === id && u.pw === pw);
            if (user) {
                currentUser = user; localStorage.setItem('currentUser', JSON.stringify(user));
                updateAuthUI(); closeModal(); alert(`${user.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`); location.reload();
            } else { alert('ì¼ì¹˜í•˜ëŠ” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'); }
        }

        function logout() {
            if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                currentUser = null; localStorage.removeItem('currentUser');
                updateAuthUI(); window.location.reload();
            }
        }

        function toggleForm(type) {
            if (!currentUser) { alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); openModal(); return; }
            const formBox = document.getElementById(type + '-form-box');
            formBox.style.display = (formBox.style.display === 'flex') ? 'none' : 'flex';
            if(formBox.style.display === 'flex') document.getElementById(type + '-title').focus();
        }

        function addPost(type) {
            if (!currentUser) { alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
            const titleInput = document.getElementById(type + '-title');
            const contentInput = document.getElementById(type + '-content');
            if (!titleInput.value) { alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            const now = new Date();
            const timeString = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;

            // ì´ë¯¸ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const imageData = tempImageData[type];

            const post = {
                id: Date.now(), type: type,
                nickname: currentUser.nickname, authorId: currentUser.id,
                title: titleInput.value, content: contentInput.value,
                image: imageData, // ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥ (ì—†ìœ¼ë©´ null)
                date: timeString, views: 0, comments: []
            };

            try {
                let posts = JSON.parse(localStorage.getItem('stylePosts')) || [];
                posts.unshift(post);
                localStorage.setItem('stylePosts', JSON.stringify(posts));
            } catch (e) {
                // ì €ì¥ ìš©ëŸ‰ ì´ˆê³¼ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
                alert("ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•˜ì—¬ ê¸€ì„ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì´ë¯¸ì§€ ìš©ëŸ‰ì„ ì¤„ì—¬ì£¼ì„¸ìš”)");
                console.error(e);
                return;
            }

            // ì…ë ¥ì°½ ë° ì„ì‹œ ë°ì´í„° ì´ˆê¸°í™”
            titleInput.value = ''; contentInput.value = '';
            clearPreview(type);
            
            toggleForm(type); renderAll();
        }

        function deletePost(event, id, authorId) {
            event.stopPropagation();
            if (!currentUser) { alert('ë¡œê·¸ì¸ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }
            if (authorId && authorId !== currentUser.id) { alert('ë³¸ì¸ ê¸€ë§Œ ì‚­ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }
            if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                let posts = JSON.parse(localStorage.getItem('stylePosts')) || [];
                posts = posts.filter(p => p.id !== id);
                localStorage.setItem('stylePosts', JSON.stringify(posts));
                renderAll();
            }
        }

        function renderAll() {
            let posts = JSON.parse(localStorage.getItem('stylePosts')) || [];
            const freeList = document.getElementById('free-list');
            const fashionList = document.getElementById('fashion-list');
            const trendList = document.getElementById('trend-list');

            freeList.innerHTML = ''; fashionList.innerHTML = ''; trendList.innerHTML = '';

            posts.forEach(post => {
                const views = post.views || 0;
                const authorId = post.authorId || '';
                const commentCount = (post.comments || []).length;
                
                // ì¸ë„¤ì¼ HTML ìƒì„± (ì´ë¯¸ì§€ê°€ ìˆì„ ë•Œë§Œ)
                const thumbnailHtml = post.image ? `<img src="${post.image}" class="post-thumbnail">` : '';

                const html = `
                    <li>
                        <div class="post-item-inner" onclick="goDetail(${post.id})">
                            ${thumbnailHtml}
                            <div class="post-info-wrapper">
                                <span class="post-title">${post.title} <span style="color:#ff4d4f; font-size:12px;">[${commentCount}]</span></span>
                                <div class="post-meta">
                                    <span class="meta-item">ğŸ‘¤ ${post.nickname}</span>
                                    <span class="meta-item">ğŸ•’ ${post.date}</span>
                                    <span class="meta-item">ğŸ‘ï¸ ${views}</span>
                                </div>
                            </div>
                        </div>
                        <button class="del-btn" onclick="deletePost(event, ${post.id}, '${authorId}')">&times;</button>
                    </li>
                `;
                if (post.type === 'free') freeList.innerHTML += html;
                else if (post.type === 'fashion') fashionList.innerHTML += html;
            });

            const trendPosts = posts.slice(0, 3);
            if(trendPosts.length > 0) {
                trendPosts.forEach((post, index) => {
                    // íŠ¸ë Œë“œì—ë„ ì¸ë„¤ì¼ ì¶”ê°€ (ì„ íƒì‚¬í•­)
                    const thumbnailHtml = post.image ? `<img src="${post.image}" class="post-thumbnail" style="width:40px; height:40px;">` : '';
                    trendList.innerHTML += `
                        <li>
                            <div class="post-item-inner" onclick="goDetail(${post.id})">
                                 ${thumbnailHtml}
                                <div class="post-info-wrapper">
                                    <span class="post-title"><span class="hot-badge">${index+1}</span> ${post.title}</span>
                                    <div class="post-meta">
                                        <span style="color:#5d5fef; font-weight:bold;">${post.type === 'free' ? 'ììœ ' : 'íŒ¨ì…˜'}</span>
                                        <span>ğŸ‘¤ ${post.nickname}</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                    `;
                });
            } else { trendList.innerHTML = '<li style="color:#aaa; text-align:center;">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>'; }
        }

        const modal = document.getElementById('login-modal');
        function openModal() { modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }
        function switchAuthMode(mode) {
            document.getElementById('login-form').style.display = (mode === 'login') ? 'block' : 'none';
            document.getElementById('signup-form').style.display = (mode === 'signup') ? 'block' : 'none';
        }
        window.onclick = function(event) { if (event.target == modal) closeModal(); }
    </script>
</body>
</html>
